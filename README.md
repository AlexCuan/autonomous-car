# Autonomous Obstacle-Avoiding Car with Bluetooth Control (STM32)

This repository contains the C source code for an autonomous mobile robot built using an STM32L152 Discovery/Nucleo development board. The robot can navigate autonomously, detect and avoid obstacles using ultrasonic sensors, and be controlled remotely via Bluetooth.

This project was developed as part of the Microprocessor Based Digital Systems course at Universidad Carlos III de Madrid.

## Features

* **Autonomous Navigation:** Moves forward and backward, detecting obstacles using front and rear HC-SR04 ultrasonic sensors.
* **Obstacle Avoidance:**
    * Progressively reduces speed when an obstacle is detected within 30cm (multiple thresholds: ~30-20cm, ~20-10cm, ~10-5cm).
    * Stops automatically if an obstacle is closer than 5cm.
    * Executes turning maneuvers (stopping one wheel, reversing the other) to navigate around obstacles detected at close range.
* **Variable Speed Control:** Maximum speed can be adjusted using an onboard potentiometer, read via the ADC. Motor speed is controlled using PWM signals generated by TIM2.
* **Acoustic Feedback:** An active buzzer provides audible alerts based on obstacle proximity. The sound pattern/frequency can indicate distance.
* **Bluetooth Remote Control:**
    * Uses an HC-05 or HC-06 module connected via USART for wireless communication.
    * Allows manual control (forward, backward, left, right, stop).
    * Enables remote configuration of parameters like minimum/maximum obstacle detection distances.
    * Sends status updates back to the connected device (e.g., mobile phone via a Serial Bluetooth Terminal app).
* **Onboard Control:** A user button on the STM32 board can cycle through movement states (Forward, Stop, Backward).
* **Real-Time Operation:** Utilizes timers (TIM2, TIM3, TIM4) and interrupts (EXTI, Timer, UART) for efficient handling of concurrent tasks like sensor reading, motor control, and communication.

## Hardware Requirements

* STM32 Development Board (e.g., STM32L152RB-Discovery)
* L298N Motor Driver Module
* 2 x DC Motors (with robot chassis, wheels, caster)
* 2 x HC-SR04 Ultrasonic Sensors
* 1 x Active Buzzer
* 1 x Potentiometer (5kΩ or 10kΩ recommended)
* 1 x Bluetooth Module (HC-05 or HC-06)
* Battery Pack (e.g., 4xAA for motors)
* Wires (Male/Female, Female/Female)

## Software & Setup

* **Language:** C
* **IDE:** STM32CubeIDE (Project file likely included in the repo)
* **Core Libraries:** STM32 HAL library
* **Configuration:** The `main.c` file and STM32CubeMX configuration handle the setup of GPIOs, Timers (PWM, Input Capture, General Timing), ADC, USART, and Interrupts.
* **Pinout:** Refer to the detailed pin assignments used in this project below

## Pin Connections

| Function                     | STM32 Pin | Connected To         |
| :--------------------------- | :-------- | :------------------- |
| Motor Driver IN1             | `PB12`    | L298N IN1            |
| Motor Driver IN2             | `PB10`    | L298N IN2            |
| Motor Driver IN3             | `PB13`    | L298N IN3            |
| Motor Driver IN4             | `PB11`    | L298N IN4            |
| Front Ultrasonic Trig        | `PC6`     | Front HC-SR04 Trig   |
| Front Ultrasonic Echo        | `PC7`     | Front HC-SR04 Echo   |
| Rear Ultrasonic Trig         | `PC8`     | Rear HC-SR04 Trig    |
| Rear Ultrasonic Echo         | `PC9`     | Rear HC-SR04 Echo    |
| Buzzer Control               | `PA3`     | Active Buzzer I/O    |
| Potentiometer Input          | `PA2`     | Potentiometer Wiper  |
| Bluetooth TX (STM32 RX)      | `PB7`     | HC-05 TXD            |
| Bluetooth RX (STM32 TX)      | `PB6`     | HC-05 RXD            |
| *Motor Driver ENA*           | *(Keep Jumper On)* | L298N ENA Jumper |
| *Motor Driver ENB*           | *(Keep Jumper On)* | L298N ENB Jumper |
| *User Button*                | `PA0`     | Onboard Button       |
| *GND*                        | `GND`     | Common Ground        |
| *Potentiometer Power*        | `5V` / `GND` | Potentiometer Legs |
| *Sensor/Buzzer/BT Power*     | `5V` / `GND`  | Module Power       |

*Note: Motor driver power (12V screw terminal) comes directly from the battery pack. Ensure common ground.*

![report schema](https://github.com/user-attachments/assets/1ae8dac3-c97f-4cf9-b213-01547d9dcd44)

## Usage

1.  **Compile & Flash:** Open the project in STM32CubeIDE, build it, and flash the code onto the STM32 board.
2.  **Power Up:** Connect the battery pack to the L298N driver and power the STM32 board.
3.  **Autonomous Mode:** The car should start in a default state (likely stopped or ready for button press/command). It will autonomously navigate and avoid obstacles based on sensor readings and the potentiometer setting.
4.  **Manual Control (Bluetooth):**
    * Pair your phone/PC with the HC-05/HC-06 Bluetooth module.
    * Use a Serial Bluetooth Terminal application (like the one mentioned in the manual) to connect. Default Baud Rate is likely 9600.
    * Send commands followed by a newline character (`\n`).

### Bluetooth Commands

* `STOP`: Stops both motors
* `FORW`: Moves the car forward
* `BACK`: Moves the car backward
* `LEFT`: Turns the car left (differential steering)
* `RIGH`: Turns the car right (differential steering)
* `CYCL`: Cycles movement state (Forward -> Stop -> Backward -> Stop...)
* `MDxx`: Sets the **M**inimum **D**istance threshold in cm (e.g., `MD05` sets stop distance to 5cm). `xx` must be two digits.
* `MAxx`: Sets the **Ma**ximum distance for progressive speed reduction in cm (e.g., `MA30` starts reducing speed below 30cm). `xx` must be two digits.

The robot will send status messages back via Bluetooth confirming actions or reporting obstacle alerts.
